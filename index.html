<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Bevy 3D Scene</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: #000;
            font-family: Arial, sans-serif;
        }
        
        canvas {
            width: 100vw !important;
            height: 100vh !important;
            max-width: none !important;
            max-height: none !important;
            display: block;
            border: none; /* Remove debug border */
            object-fit: fill;
        }
        
        /* Fullscreen styles */
        :fullscreen canvas {
            width: 100vw !important;
            height: 100vh !important;
            max-width: none !important;
            max-height: none !important;
        }
        
        :-webkit-full-screen canvas {
            width: 100vw !important;
            height: 100vh !important;
            max-width: none !important;
            max-height: none !important;
        }
        
        :-moz-full-screen canvas {
            width: 100vw !important;
            height: 100vh !important;
            max-width: none !important;
            max-height: none !important;
        }
        
        #loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 18px;
            text-align: center;
            z-index: 1000;
        }
        
        #error {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: red;
            font-size: 16px;
            text-align: center;
            display: none;
            z-index: 1000;
        }
        
        #debug {
            position: absolute;
            top: 10px;
            left: 10px;
            color: white;
            font-size: 12px;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div id="loading">Loading Bevy 3D Scene...</div>
    <div id="error"></div>
    <div id="debug"></div>
    <canvas id="canvas"></canvas>
    
    <script type="module">
        import init from './pkg/bevy_3d_fog_scene.js';
        
        async function run() {
            try {
                console.log('Starting WASM initialization...');
                
                // Make sure canvas is visible and properly sized before initializing
                const canvas = document.getElementById('canvas');
                canvas.style.display = 'block';
                canvas.style.width = '100vw';
                canvas.style.height = '100vh';
                canvas.style.maxWidth = 'none';
                canvas.style.maxHeight = 'none';
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
                console.log('Canvas made visible and sized to:', canvas.width, 'x', canvas.height);
                
                await init();
                console.log('WASM initialized successfully');
                
                // Check if canvas exists and is visible
                console.log('Canvas element:', canvas);
                console.log('Canvas dimensions:', canvas.width, 'x', canvas.height);
                console.log('Canvas style display:', canvas.style.display);
                
                document.getElementById('loading').style.display = 'none';
                
                // Update debug info
                document.getElementById('debug').innerHTML = `
                    Canvas: ${canvas.width}x${canvas.height}<br>
                    Display: ${canvas.style.display}<br>
                    WASM: Loaded<br>
                    Time: ${new Date().toLocaleTimeString()}
                `;
                
                console.log('Scene should now be visible');
                
                // Handle window resize to maintain fullscreen
                window.addEventListener('resize', () => {
                    canvas.style.width = '100vw';
                    canvas.style.height = '100vh';
                    canvas.style.maxWidth = 'none';
                    canvas.style.maxHeight = 'none';
                    canvas.width = window.innerWidth;
                    canvas.height = window.innerHeight;
                    console.log('Canvas resized to:', canvas.width, 'x', canvas.height);
                });
                
                // Handle fullscreen changes
                document.addEventListener('fullscreenchange', () => {
                    canvas.style.width = '100vw';
                    canvas.style.height = '100vh';
                    canvas.style.maxWidth = 'none';
                    canvas.style.maxHeight = 'none';
                    if (document.fullscreenElement) {
                        canvas.width = window.screen.width;
                        canvas.height = window.screen.height;
                        console.log('Fullscreen canvas resized to:', canvas.width, 'x', canvas.height);
                    } else {
                        canvas.width = window.innerWidth;
                        canvas.height = window.innerHeight;
                        console.log('Windowed canvas resized to:', canvas.width, 'x', canvas.height);
                    }
                });
            } catch (error) {
                console.error('Failed to load WASM module:', error);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').style.display = 'block';
                document.getElementById('error').textContent = 'Failed to load 3D scene: ' + error.message;
            }
        }
        
        run();
    </script>
</body>
</html>